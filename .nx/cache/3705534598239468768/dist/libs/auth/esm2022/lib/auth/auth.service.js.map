{"version":3,"file":"auth.service.js","sourceRoot":"","sources":["../../../../../../libs/auth/src/lib/auth/auth.service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAClD,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AACnD,OAAO,EAAE,UAAU,EAAE,GAAG,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAEnD,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAC;AACnD,OAAO,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAC;;AAKzC,MAAM,OAAO,WAAW;IACtB,IAAI,GAAG,MAAM,CAAC,UAAU,CAAC,CAAA;IACzB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAA;IACvB,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC,CAAA;IACrC,UAAU,GAAG,wCAAwC,CAAA;IACrD,KAAK,GAAkB,IAAI,CAAA;IAC3B,YAAY,GAAkB,IAAI,CAAA;IAElC,IAAI,MAAM;QACR,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YAChB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;YAC5C,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,cAAc,CAAC,CAAA;QAC5D,CAAC;QAED,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAA;IACrB,CAAC;IAED,KAAK,CAAC,OAA6C;QACjD,MAAM,EAAE,GAAG,IAAI,QAAQ,EAAE,CAAA;QAEzB,EAAE,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAA;QACvC,EAAE,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAA;QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAgB,GAAG,IAAI,CAAC,UAAU,OAAO,EAAE,EAAE,CAAC;aAClE,IAAI,CACH,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CACjC,CAAA;IACH,CAAC;IAED,gBAAgB;QACd,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CACnB,GAAG,IAAI,CAAC,UAAU,SAAS,EAC3B,EAAC,aAAa,EAAE,IAAI,CAAC,YAAY,EAAC,CACnC,CAAC,IAAI,CACJ,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,EAChC,UAAU,CAAC,KAAK,CAAC,EAAE;YACjB,IAAI,CAAC,MAAM,EAAE,CAAA;YACb,OAAO,UAAU,CAAC,KAAK,CAAC,CAAA;QAC1B,CAAC,CAAC,CACH,CAAA;IACH,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,CAAA;QAC9B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;QACjB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAA;QACxB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAA;IAClC,CAAC;IAED,UAAU,CAAC,GAAkB;QAC3B,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,YAAY,CAAA;QAC7B,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC,aAAa,CAAA;QACrC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;QAC3C,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,YAAY,CAAC,CAAA;IAC3D,CAAC;qGArDU,WAAW;gEAAX,WAAW,WAAX,WAAW,mBAFV,MAAM;;iFAEP,WAAW;cAHvB,UAAU;eAAC;gBACV,UAAU,EAAE,MAAM;aACnB","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { inject, Injectable } from '@angular/core';\r\nimport { catchError, tap, throwError } from 'rxjs';\r\nimport { TokenResponse } from './auth.interface';\r\nimport { CookieService } from 'ngx-cookie-service';\r\nimport { Router } from '@angular/router';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AuthService {\r\n  http = inject(HttpClient)\r\n  router = inject(Router)\r\n  cookieService = inject(CookieService)\r\n  baseApiUrl = 'https://icherniakov.ru/yt-course/auth/'\r\n  token: string | null = null\r\n  refreshToken: string | null = null\r\n\r\n  get isAuth() {\r\n    if (!this.token) {\r\n      this.token = this.cookieService.get('token')\r\n      this.refreshToken = this.cookieService.get('refreshToken')\r\n    }\r\n\r\n    return !!this.token\r\n  }\r\n\r\n  login(payload: {username: string, password: string}) {\r\n    const fd = new FormData()\r\n\r\n    fd.append('username', payload.username)\r\n    fd.append('password', payload.password)\r\n    return this.http.post<TokenResponse>(`${this.baseApiUrl}token`, fd)\r\n    .pipe(\r\n      tap(val => this.saveTokens(val))\r\n    )\r\n  }\r\n\r\n  refreshAuthToken() {\r\n    return this.http.post<TokenResponse>(\r\n      `${this.baseApiUrl}refresh`,\r\n      {refresh_token: this.refreshToken}\r\n    ).pipe(\r\n      tap(val => this.saveTokens(val)),\r\n      catchError(error => {\r\n        this.logout()\r\n        return throwError(error)\r\n      })\r\n    )\r\n  }\r\n\r\n  logout() {\r\n    this.cookieService.deleteAll()\r\n    this.token = null\r\n    this.refreshToken = null\r\n    this.router.navigate(['/login'])\r\n  }\r\n\r\n  saveTokens(res: TokenResponse) {\r\n    this.token = res.access_token\r\n    this.refreshToken = res.refresh_token\r\n    this.cookieService.set('token', this.token)\r\n    this.cookieService.set('refreshToken', this.refreshToken)\r\n  }\r\n}\r\n"]}